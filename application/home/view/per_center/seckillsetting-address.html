
    <title>设置-个人信息</title>
     <link rel="icon" href="/assets/img/favicon.ico">

    <link rel="stylesheet" type="text/css" href="../css/pages-seckillOrder.css" />
    <link rel="stylesheet" type="text/css" href="/static/home/css/pages-seckillOrder.css" />

    <!--header-->
    <div id="account">
        <div class="py-container">
            <div class="yui3-g home">
                <!--左侧列表-->
                <div class="yui3-u-1-6 list">

                    <div class="person-info">
                        <div class="person-photo"><img src="../img/_/photo.png" alt=""></div>
                        <div class="person-account">
                            <span class="name">Michelle</span>
                            <span class="safe">账户安全</span>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="list-items">
                        <dl>
							<dt><i>·</i> 订单中心</dt>
							<dd ><a href="seckillOrder.html">我的订单</a></dd>
							<dd><a href="seckillorder-pay.html">待付款</a></dd>
							<dd><a href="seckillorder-send.html">待发货</a></dd>
							<dd><a href="seckillorder-receive.html">待收货</a></dd>
							<dd><a href="seckillorder-evaluate.html">待评价</a></dd>
						</dl>
						<dl>
							<dt><i>·</i> 我的中心</dt>
							<dd><a href="seckillperson-collect.html">我的收藏</a></dd>
							<dd><a href="seckillperson-footmark.html">我的足迹</a></dd>
						</dl>
						<dl>
							<dt><i>·</i> 物流消息</dt>
						</dl>
						<dl>
							<dt><i>·</i> 设置</dt>
							<dd><a href="{:url('home/PerCenter/message')}">个人信息</a></dd>
							<dd><a href="{:url('home/PerCenter/address')}"   class="list-active">地址管理</a></dd>
							<dd><a href="{:url('home/PerCenter/safety')}" >安全管理</a></dd>
						</dl>
                    </div>
                </div>
                <!--右侧主内容-->
                <div class="yui3-u-5-6">
                    <div class="body userAddress">
                        <div class="address-title">
                            <span class="title">地址管理</span>
                            <a data-toggle="modal" data-target="#addModal" data-keyboard="false"   class="sui-btn  btn-info add-new">添加新地址</a>
                            <span class="clearfix"></span>
                        </div>
                        <div class="address-detail">
                            <table class="sui-table table-bordered">
                                <thead>
                                    <tr>
                                        <th>姓名</th>
                                        <th>地址</th>
                                        <th>联系电话</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {foreach $site as $k=>$v}
                                    <tr address_id="{$v.id}" area="{$v.area}" address="{$v.address}">
                                        <td>{$v.consignee}</td>
                                        <td>{$v.area} {$v.address}</td>
                                        <td>{$v.phones}</td>
                                        <td>
                                            <a id="save" data-toggle="modal" data-target="#editModal" class="edit" data-keyboard="false" >编辑</a>
                                            <a class="die">删除</a>
                                            {if condition="$v.is_default==1"}
                                            默认地址
                                            {else /}
                                            <a class="default">设为默认</a>
                                            {/if}
                                        </td>
                                    </tr>
                                {/foreach}
                                    
                                </tbody>
                            </table>                          
                        </div>
                        <!--新增地址弹出层-->
                         <div  tabindex="-1" role="dialog" id="addModal" data-hasfoot="false" class="sui-modal hide fade" style="width:580px;">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" data-dismiss="modal" aria-hidden="true" class="sui-close">×</button>
                                        <h4 id="myModalLabel" class="modal-title">新增地址</h4>
                                    </div>
                                    <div class="modal-body">
                                        <form action="" class="sui-form form-horizontal">
                                            <div class="control-group">
                                            <label class="control-label">收货人：</label>
                                                <div class="controls">
                                                    <input id="person" type="text" class="input-medium">
                                                </div>
                                            </div>
                                        <div class="control-group">
                                            <label class="control-label">所在地区：</label>
                                            <div class="controls">
                                                <div data-toggle="distpicker">
                                                <div class="form-group area">
                                                    <select class="form-control" id="province1"></select>
                                                </div>
                                                <div class="form-group area">
                                                    <select class="form-control" id="city1"></select>
                                                </div>
                                                <div class="form-group area">
                                                    <select class="form-control" id="district1"></select>
                                                </div>
                                            </div>
                                            </div>									 
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label">详细地址：</label>
                                            <div class="controls">
                                                <input id="site" type="text" class="input-large">
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label">联系电话：</label>
                                            <div class="controls">
                                                <input id="phone" type="text" class="input-medium">
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label">邮箱：</label>
                                            <div class="controls">
                                                <input id="email" type="text" class="input-medium">
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label">地址别名：</label>
                                            <div class="controls">
                                                <input id="nickname" type="text" class="input-medium">
                                            </div>
                                            <div class="othername">
                                                建议填写常用地址：<a href="#" class="sui-btn btn-default">家里</a>　<a href="#" class="sui-btn btn-default">父母家</a>　<a href="#" class="sui-btn btn-default">公司</a>
                                            </div>
                                        </div>
                                        
                                        </form>
                                        
                                        
                                    </div>
                                    <div class="modal-footer">
                                        <button id="yes" type="button" data-ok="modal" class="sui-btn btn-primary btn-large">确定</button>
                                        <button type="button" data-dismiss="modal" class="sui-btn btn-default btn-large">取消</button>
                                    </div>
                                </div>
                            </div>
						</div>
                        <!--编辑地址弹出框-->
                        <div  tabindex="-1" role="dialog" id="editModal" data-hasfoot="false" class="sui-modal hide fade" style="width:580px;">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" data-dismiss="modal" aria-hidden="true" class="sui-close">×</button>
                                        <h4 id="myModalLabel2" class="modal-title">新增地址</h4>
                                    </div>
                                    <div class="modal-body">
                                        <form action="" class="sui-form form-horizontal">
                                            <div class="control-group">
                                                <label class="control-label">收货人：</label>
                                                <div class="controls">
                                                    <input name="consignee" id="person2" type="text" class="input-medium">
                                                </div>
                                            </div>
                                            <div class="control-group">
                                                <label class="control-label">所在地区：</label>
                                                <div class="controls">
                                                    <div id="distpicker2">
                                                        <div class="form-group area">
                                                            <select name="province" class="form-control" id="province2"></select>
                                                        </div>
                                                        <div class="form-group area">
                                                            <select name="city" class="form-control" id="city2"></select>
                                                        </div>
                                                        <div class="form-group area">
                                                            <select name="district" class="form-control" id="district2"></select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="control-group">
                                                <label class="control-label">详细地址：</label>
                                                <div class="controls">
                                                    <input name="address" id="site2" type="text" class="input-large">
                                                </div>
                                            </div>
                                            <div class="control-group">
                                                <label class="control-label">联系电话：</label>
                                                <div class="controls">
                                                    <input name="phone" id="phone2" type="text" class="input-medium">
                                                </div>
                                            </div>
                                            <div class="control-group">
                                                <label class="control-label">邮箱：</label>
                                                <div class="controls">
                                                    <input id="email2" type="text" class="input-medium">
                                                </div>
                                            </div>
                                            <div class="control-group">
                                                <label class="control-label">地址别名：</label>
                                                <div class="controls">
                                                    <input id="nickname2" type="text" class="input-medium">
                                                </div>
                                                <div class="othername">
                                                    建议填写常用地址：<a href="#" class="sui-btn btn-default">家里</a>　<a href="#" class="sui-btn btn-default">父母家</a>　<a href="#" class="sui-btn btn-default">公司</a>
                                                </div>
                                            </div>

                                        </form>


                                    </div>
                                    <div class="modal-footer">
                                        <button id="yes2" type="button" data-ok="modal" aid="" class="sui-btn btn-primary btn-large">确定</button>
                                        <button type="button" data-dismiss="modal" class="sui-btn btn-default btn-large">取消</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




<script>
    $(function (){
        var user_id//编辑确定时发送ajax用
        //添加确定
        $('#yes').click(function (){
            var person=$('#person').val();
            var province=$('#province1').val();
            var city=$('#city1').val();
            var district=$('#district1').val();
            var site=$('#site').val();
            var phone=$('#phone').val();

            // console.log(province);
            var data={
                'person':person,
                'province':province,
                'city':city,
                'district':district,
                'site':site,
                'phone':phone,
            }
            $.ajax({
                'url':"{:url('home/PerCenter/sitesave')}",
                'type':'post',
                'data':data,
                'dataType':'json',
                'success':function(res){
                    if(res['code']==200){
                        alert(res['msg']);
                        location.href="{:url('home/PerCenter/address')}"
                    }else{
                        alert(res['msg']);
                    }
                }
            })
        });
        //编辑确定
        $('#yes2').click(function (){
            var user_id=$(this).attr('aid');
            var person=$('#person2').val();
            var province=$('#province2').val();
            var city=$('#city2').val();
            var district=$('#district2').val();
            var site=$('#site2').val();
            var phone=$('#phone2').val();

            // console.log(province);
            var data={
                'person':person,
                'province':province,
                'city':city,
                'district':district,
                'site':site,
                'phone':phone,
                'user_id':user_id
            }
            console.log(data);
            $.ajax({
                'url':"{:url('home/PerCenter/sitemodify')}",
                'type':'post',
                'data':data,
                'dataType':'json',
                'success':function(res){
                    // console.log(res);
                    if(res['code']==200){
                        alert(res['msg']);
                        location.href="{:url('home/PerCenter/address')}"
                    }else{
                        alert(res['msg']);
                    }
                }
            })
           // console.log(user_id);
        });
        //删除
        $('.die').click(function (){
            if(confirm('是否确认删除')){
                var id=$(this).closest('tr').attr('address_id') ;
                $.ajax({
                    'url':"{:url('home/PerCenter/sitedie')}",
                    'type':'post',
                    'data':{'id':id},
                    'dataType':'json',
                    'success':function(res){
                        console.log(res);
                        if(res['code']==200){
                            alert(res['msg']);
                            location.href="{:url('home/PerCenter/address')}"
                        }else{
                            alert(res['msg']);
                        }
                    }
                })
            }else{

            }
        });
        //设为默认
        $('.default').click(function (){
            var id=$(this).closest('tr').attr('address_id') ;
            $.ajax({
                'url':"{:url('home/PerCenter/defaults')}",
                'type':'post',
                'data':{'id':id},
                'dataType':'json',
                'success':function(res){
                    // console.log(res);
                    if(res['code']==200){
                        // alert(res['msg']);
                        location.href="{:url('home/PerCenter/address')}"
                    }else{
                        alert(res['msg']);
                    }
                }
            })
        });
        //编辑弹出框

        console.log(user_id);
        $('.edit').click(function (){
            var id=$(this).closest('tr').attr('address_id');
            $('#yes2').attr('aid',id);
            // console.log(id);
            $('#editModal input[name=id]').val(id);
            var consignee=$(this).closest('tr').find('td:first').html();
            // console.log(consignee);
            var phone=$(this).closest('tr').find('td:eq(2)').html();
            var address=$(this).closest('tr').attr('address');
            $('#editModal input[name=consignee]').val(consignee);
            $('#editModal input[name=phone]').val(phone);
            $('#editModal input[name=address]').val(address);
            var area=$(this).closest('tr').attr('area').split(' ');
            $('#distpicker2').distpicker('destroy').distpicker({
                province:area[0],
                city:area[1],
                district:area[2]
            });
        });
    });
</script>
<!--<script type="text/javascript" src="../../pages/userInfo/distpicker.data.js"></script>-->
<!--<script type="text/javascript" src="../../pages/userInfo/distpicker.js"></script>-->
<!--<script type="text/javascript" src="../../pages/userInfo/main.js"></script>-->
